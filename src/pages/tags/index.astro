---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import FadeIn from '../../components/animations/FadeIn.jsx';
import AnimatedTag from '../../components/animations/AnimatedTag.jsx';
import { formatTagForDisplay, sortTags } from '../../utils/tagUtils';
// import '../../styles/tags-index.less'; // Import the Less file

const logEntries = await getCollection('log', ({ data }) => {
  return data.draft !== true;
});

const allTags = logEntries.flatMap(entry => entry.data.tags || []);
const uniqueTags = [...new Set(allTags)];
// Sort tags with standardized tags first
const sortedTags = sortTags(uniqueTags);
---

<BaseLayout title="Tags - nibzard" description="Browse content by tags.">
  <FadeIn client:visible>
    <section class="tags-header">
      <h1>All Tags</h1>
      <p>Browse articles and logs by topic.</p>
    </section>
  </FadeIn>

  <FadeIn client:visible delay={0.1}>
    {sortedTags.length > 0 ? (
      <ul class="tags-list">
        {sortedTags.map((tag, index) => {
          const formattedTag = formatTagForDisplay(tag);
          return (
            <FadeIn client:visible delay={0.1 + index * 0.05}>
              <li class="tag-item">
                <AnimatedTag
                  client:visible
                  href={`/tags/${tag.toLowerCase()}`}
                  tagText={formattedTag}
                />
              </li>
            </FadeIn>
          );
        })}
      </ul>
    ) : (
      <p class="no-tags">No tags found yet. Add tags to your log entries to see them here.</p>
    )}
  </FadeIn>
</BaseLayout>

<style>
/* Styles for /Users/nikola/dev/nibzard/src/pages/tags/index.astro */
.tags-header {
  margin-bottom: var(--space-lg);
  padding-bottom: var(--space-md);
  border-bottom: 1px solid var(--color-subtle);
}
.tags-header h1 {
  font-size: 2.5rem;
}
.tags-list {
  list-style: none;
  padding: 0;
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-md);
}
.tag-item a {
  display: inline-block;
  background-color: var(--color-subtle);
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--border-radius);
  font-size: 0.9rem;
  font-family: var(--font-mono);
  text-decoration: none;
  color: #555;
  transition: background-color 0.2s ease, color 0.2s ease;
}
.tag-item a:hover {
  background-color: var(--color-accent-3);
  color: var(--color-text);
}
.no-tags {
  font-style: italic;
  color: #777;
}
</style>