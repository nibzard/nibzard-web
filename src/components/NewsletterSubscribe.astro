---
/**
 * NewsletterSubscribe Component
 * A reusable newsletter subscription form with customizable button text
 */

interface Props {
  title?: string;
  description?: string;
  buttonText?: string;
  showButton?: boolean;
}

const title = Astro.props.title ?? "Stay Updated";
const description = Astro.props.description ?? "Subscribe to receive the latest updates and articles directly in your inbox.";
const buttonText = Astro.props.buttonText ?? "Subscribe";
const showButton = Astro.props.showButton ?? true;
---

<div class="newsletter-card">
  <h3>{title}</h3>
  <p>{description}</p>
  <div id="form-message" class="form-message" style="display:none;"></div>
  <form class="newsletter-form" id="newsletter-form">
    <div class="newsletter-input-group">
      <input type="email" name="email" placeholder="Your email address" class="newsletter-input" required />
      <input type="text" name="firstName" placeholder="First name (optional)" class="newsletter-input" style="min-width:120px;" />
      <input type="text" name="lastName" placeholder="Last name (optional)" class="newsletter-input" style="min-width:120px;" />
      {showButton && <button type="submit" class="newsletter-button">{buttonText}</button>}
    </div>
    <label class="newsletter-privacy">
      <input type="checkbox" required />
      <span>I agree to receive emails and can unsubscribe at any time</span>
    </label>
  </form>
</div>

<script type="module">
  const form = document.getElementById('newsletter-form');
  const messageDiv = document.getElementById('form-message');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    messageDiv.style.display = 'none';
    messageDiv.className = 'form-message';
    const formData = new FormData(form);
    const data = {
      email: formData.get('email'),
      firstName: formData.get('firstName'),
      lastName: formData.get('lastName'),
    };
    try {
      const res = await fetch('/api/subscribe', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });
      const result = await res.json();
      if (result.success) {
        messageDiv.textContent = 'Thanks for subscribing! Please check your email to confirm.';
        messageDiv.classList.add('success');
        form.reset();
      } else {
        messageDiv.textContent = result.error || 'An error occurred. Please try again.';
        messageDiv.classList.add('error');
      }
    } catch (err) {
      messageDiv.textContent = 'An unexpected issue occurred. Please try again.';
      messageDiv.classList.add('error');
    }
    messageDiv.style.display = 'block';
  });
</script>

<style>
  .newsletter-card {
    background-color: var(--color-subtle);
    border-radius: var(--border-radius);
    padding: var(--space-lg);
    border: 1px solid var(--color-border);
  }

  .newsletter-card h3 {
    margin-top: 0;
    margin-bottom: var(--space-sm);
  }

  .newsletter-form {
    margin-top: var(--space-md);
  }

  .newsletter-input-group {
    display: flex;
    gap: var(--space-xs);
    margin-bottom: var(--space-sm);
    flex-wrap: wrap;
  }

  .newsletter-input {
    flex: 1;
    min-width: 250px;
    padding: var(--space-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius);
    font-size: 1rem;
  }

  .newsletter-button {
    background-color: var(--color-accent2);
    color: white;
    border: none;
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--border-radius);
    cursor: pointer;
    font-weight: 500;
  }

  .newsletter-privacy {
    display: flex;
    align-items: flex-start;
    gap: var(--space-xs);
    font-size: 0.8rem;
    color: var(--color-text-muted);
  }

  .newsletter-privacy input {
    margin-top: 3px;
  }

  @media (max-width: 768px) {
    .newsletter-input-group {
      flex-direction: column;
    }

    .newsletter-input {
      width: 100%;
    }

    .newsletter-button {
      width: 100%;
    }
  }

  .form-message {
    padding: var(--space-sm);
    border-radius: var(--border-radius);
    margin-bottom: var(--space-md);
    text-align: center;
  }
  .form-message.success {
    background-color: var(--color-success-bg);
    color: var(--color-success-text);
    border: 1px solid var(--color-success-border);
  }
  .form-message.error {
    background-color: var(--color-danger-bg);
    color: var(--color-danger-text);
    border: 1px solid var(--color-danger-border);
  }
</style>