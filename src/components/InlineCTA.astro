---
// ABOUTME: Inline call-to-action for newsletter subscription within articles
// ABOUTME: Subtle design with embedded email input

interface Props {
  message?: string;
  emphasis?: string;
  buttonText?: string;
}

const message = Astro.props.message ?? "Enjoying this?";
const emphasis = Astro.props.emphasis ?? "Get more like this in your inbox.";
const buttonText = Astro.props.buttonText ?? "Subscribe";
---

<div class="inline-cta">
  <p class="inline-cta-text">
    <span class="inline-cta-message">{message}</span>
    <span class="inline-cta-emphasis">{emphasis}</span>
  </p>
  <form class="inline-cta-form" id="inline-cta-form">
    <input
      type="email"
      name="email"
      placeholder="your@email.com"
      required
      class="inline-cta-input"
    />
    <button type="submit" class="inline-cta-button">{buttonText}</button>
  </form>
  <div id="inline-cta-message" class="inline-cta-message-box"></div>
</div>

<script>
  const form = document.getElementById('inline-cta-form');
  const messageDiv = document.getElementById('inline-cta-message');

  if (form && messageDiv) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      messageDiv.style.display = 'none';
      messageDiv.className = 'inline-cta-message-box';

      const formData = new FormData(form);
      const email = formData.get('email');

      try {
        const res = await fetch('/api/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email }),
        });
        const result = await res.json();

        if (result.success) {
          messageDiv.textContent = 'Thanks! Check your inbox to confirm.';
          messageDiv.classList.add('success');
          form.reset();
          form.style.display = 'none';
        } else {
          messageDiv.textContent = result.error || 'Something went wrong.';
          messageDiv.classList.add('error');
        }
      } catch (err) {
        messageDiv.textContent = 'Something went wrong. Please try again.';
        messageDiv.classList.add('error');
      }
      messageDiv.style.display = 'block';
    });
  }
</script>

<style>
  .inline-cta {
    padding: var(--space-md) 0;
    margin: var(--space-lg) auto;
    max-width: 420px;
    text-align: center;
  }

  .inline-cta-text {
    margin: 0 0 var(--space-sm) 0;
    font-size: 0.9375rem;
    line-height: 1.5;
  }

  .inline-cta-message {
    color: var(--color-text);
    display: block;
    margin-bottom: 0.125rem;
  }

  .inline-cta-emphasis {
    color: var(--color-text-muted);
    font-weight: 400;
    display: block;
  }

  .inline-cta-form {
    display: flex;
    gap: var(--space-xs);
    flex-wrap: wrap;
    justify-content: center;
  }

  .inline-cta-input {
    flex: 1;
    min-width: 160px;
    padding: 0.5rem var(--space-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius);
    background: var(--color-background);
    color: var(--color-text);
    font-size: 0.875rem;
    font-family: var(--font-mono-neon);
  }

  .inline-cta-input:focus {
    outline: none;
    border-color: var(--color-accent1);
    box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
  }

  .inline-cta-button {
    padding: 0.5rem var(--space-md);
    background: var(--color-accent2);
    color: white;
    border: none;
    border-radius: var(--border-radius);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition-fast);
    font-family: var(--font-mono-neon);
    white-space: nowrap;
  }

  .inline-cta-button:hover {
    background: var(--color-accent1);
  }

  .inline-cta-message-box {
    display: none;
    margin-top: var(--space-sm);
    font-size: 0.8125rem;
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--border-radius);
  }

  .inline-cta-message-box.success {
    display: block;
    background: rgba(34, 197, 94, 0.1);
    color: #16a34a;
  }

  .inline-cta-message-box.error {
    display: block;
    background: rgba(239, 68, 68, 0.1);
    color: #dc2626;
  }

  @media (max-width: 768px) {
    .inline-cta {
      padding: var(--space-sm);
      max-width: 100%;
    }

    .inline-cta-text {
      font-size: 0.875rem;
    }

    .inline-cta-form {
      flex-direction: column;
    }

    .inline-cta-input {
      width: 100%;
    }

    .inline-cta-button {
      width: 100%;
    }
  }
</style>
